#include "cenario.h"

// popula_cenario
/*
    Preenche a matriz do cenario com a leitura do arquivo de texto
    Caso nao encontre o arquivo, usa cenarios padroes arbitrarios
*/
void popula_cenario(char addr_cenario[LINHAS_CENARIO][COLUNAS_CENARIO], int numero_cenario) {
    int i, j;
    FILE *arq_mapa;
    char nome_arq[9];
    char buf[COLUNAS_CENARIO + 1];
    char cenario[NUM_CENARIOS][LINHAS_CENARIO][COLUNAS_CENARIO] = {{
                            {"1111111111111111111111111111111111111111111111111111111111111111111111111111111"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1111111111111111111111111111111111111111111111111111111111111111111111111111111"}},
                            {
                            {"1111111111111111111111111111111111111111111111111111111111111111111111111111111"},
                            {"1000000000000000000000000000000000000000010000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000010000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000010000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000010000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000010000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000010000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000010000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000010000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000010000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000010000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000010000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000010000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000010000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000010000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000010000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000010000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000010000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000010000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000010000000000000000000000000000000000001"},
                            {"1111111111111111111111111111111111111111111111111111111111111111111111111111111"}},
                            {
                            {"1111111111111111111111111111111111111111111111111111111111111111111111111111111"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000111111111111000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000001000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000001000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000001000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000001000000000000000000001"},
                            {"1000000000000000000000000011111111111110000000000000000001000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000001000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1000000000000000000000000000000000000000000000000000000000000000000000000000001"},
                            {"1111111111111111111111111111111111111111111111111111111111111111111111111111111"}}};

    sprintf(nome_arq, "map%d.txt", numero_cenario);
    if ((arq_mapa = fopen(nome_arq, "r")) != NULL) {

        for (i = 0; i < LINHAS_CENARIO; i++) {
            fgets(buf, COLUNAS_CENARIO + 1, arq_mapa);
            for (j = 0; j < COLUNAS_CENARIO; j++) {
                addr_cenario[i][j] = buf[j];
            }

        }
        fclose(arq_mapa);

    } else {

        for (i = 0; i < LINHAS_CENARIO; i++) {
            for (j = 0; j < COLUNAS_CENARIO; j++) {
                addr_cenario[i][j] = cenario[numero_cenario-1][i][j];
            }
        }

    }
}

// inicializa_cenario
/*
    Popula array do cenario, faz a inicializacao dele na tela e trata tuneis.
*/
void inicializa_cenario(char cenario[LINHAS_CENARIO][COLUNAS_CENARIO], int numero_cenario, TUNEL tuneis[MAX_TUNEIS], int *num_tuneis) {

    // Cenario
    popula_cenario(cenario, numero_cenario);
    desenha_cenario(cenario);

    // Tuneis
    *num_tuneis = inicializa_tuneis(tuneis, numero_cenario);
    posiciona_tuneis_no_cenario(cenario, tuneis, *num_tuneis);
    desenha_tuneis(tuneis, *num_tuneis);

}


// desenha_cenario
/*
    Inicializa o cenario na tela
*/
void desenha_cenario(char cenario[LINHAS_CENARIO][COLUNAS_CENARIO]) {
    int i, j;

    seta_cor_bg(COR_BG_CENARIO);
    seta_cor_texto(COR_TEXTO_PADRAO);
    for (i = 0; i < LINHAS_CENARIO; i++) {
        for (j = 0; j < COLUNAS_CENARIO; j++) {
            if (cenario[i][j] == '1') {
                escreve_char_xy(j+1, i+2, '|');
            } else {
                escreve_char_xy(j+1, i+2, ' ');
            }
        }
    }
    seta_cor_texto(COR_TEXTO_PADRAO);
    vai_para_xy(1,1); // Volta o cursor para o início da tela
}


